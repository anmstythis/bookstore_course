{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useEffect, useState } from 'react';\nimport axios from 'axios';\nimport { getCurrentUserId } from '../utils/userUtils.js';\nimport { getCartFromStorage } from '../utils/cartUtils.js';\nimport { getFavoritesFromStorage } from '../utils/favoriteUtils.js';\nexport const useBooksData = () => {\n  _s();\n  const [data, setData] = useState([]);\n  const [error, setError] = useState(null);\n  const [loading, setLoading] = useState(true);\n  useEffect(() => {\n    const fetchData = async () => {\n      try {\n        const [booksRes, authorsRes] = await Promise.all([axios.get('http://localhost:5000/api/books'), axios.get('http://localhost:5000/api/authors'), axios.get('http://localhost:5000/api/publishers')]);\n        const authors = authorsRes.data || [];\n        const userId = getCurrentUserId();\n        const cart = getCartFromStorage(userId);\n        const favorites = getFavoritesFromStorage(userId);\n        const cartByBookId = new Map(cart.map(ci => [ci.bookId, ci.quantity]));\n        const favoriteIds = new Set(favorites.map(f => f.bookId));\n        const mapped = (booksRes.data || []).map(row => {\n          const author = authors.find(a => a.id_author === row.author_id);\n          return {\n            id: row.id_book,\n            name: row.title,\n            authorId: row.author_id,\n            author: author ? `${author.firstname} ${author.lastname}` : 'Неизвестный автор',\n            price: Number(row.price),\n            url: row.imageurl,\n            publisher: publisher ? publisher.legalname : 'Неизвестный издатель',\n            description: row.description,\n            categoryId: row.category_id,\n            addedToCart: cartByBookId.has(row.id_book),\n            addedAmount: cartByBookId.get(row.id_book) || 0,\n            isFavorite: favoriteIds.has(row.id_book)\n          };\n        });\n        setData(mapped);\n        console.log('Полученные книги:', mapped);\n      } catch (err) {\n        console.error('Ошибка при загрузке данных:', err);\n        setError(err.message);\n      } finally {\n        setLoading(false);\n      }\n    };\n    fetchData();\n  }, []);\n  return {\n    data,\n    setData,\n    error,\n    loading\n  };\n};\n_s(useBooksData, \"malMnQdwM2qcKJJQledZbUt2mHk=\");","map":{"version":3,"names":["useEffect","useState","axios","getCurrentUserId","getCartFromStorage","getFavoritesFromStorage","useBooksData","_s","data","setData","error","setError","loading","setLoading","fetchData","booksRes","authorsRes","Promise","all","get","authors","userId","cart","favorites","cartByBookId","Map","map","ci","bookId","quantity","favoriteIds","Set","f","mapped","row","author","find","a","id_author","author_id","id","id_book","name","title","authorId","firstname","lastname","price","Number","url","imageurl","publisher","legalname","description","categoryId","category_id","addedToCart","has","addedAmount","isFavorite","console","log","err","message"],"sources":["C:/Users/My/OneDrive/Документы/конспекты/документы к курсачу 4 курс/project/bookmix/src/utils/booksUtils.js"],"sourcesContent":["import { useEffect, useState } from 'react';\r\nimport axios from 'axios';\r\nimport { getCurrentUserId } from '../utils/userUtils.js';\r\nimport { getCartFromStorage } from '../utils/cartUtils.js';\r\nimport { getFavoritesFromStorage } from '../utils/favoriteUtils.js';\r\n\r\nexport const useBooksData = () => {\r\n  const [data, setData] = useState([]);\r\n  const [error, setError] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    const fetchData = async () => {\r\n      try {\r\n        const [booksRes, authorsRes] = await Promise.all([\r\n          axios.get('http://localhost:5000/api/books'),\r\n          axios.get('http://localhost:5000/api/authors'),\r\n          axios.get('http://localhost:5000/api/publishers')\r\n        ]);\r\n\r\n        const authors = authorsRes.data || [];\r\n\r\n        const userId = getCurrentUserId();\r\n        const cart = getCartFromStorage(userId);\r\n        const favorites = getFavoritesFromStorage(userId);\r\n\r\n        const cartByBookId = new Map(cart.map(ci => [ci.bookId, ci.quantity]));\r\n        const favoriteIds = new Set(favorites.map(f => f.bookId));\r\n\r\n        const mapped = (booksRes.data || []).map(row => {\r\n          const author = authors.find(a => a.id_author === row.author_id);\r\n\r\n          return {\r\n            id: row.id_book,\r\n            name: row.title,\r\n            authorId: row.author_id,\r\n            author: author ? `${author.firstname} ${author.lastname}` : 'Неизвестный автор',\r\n            price: Number(row.price),\r\n            url: row.imageurl,\r\n            publisher: publisher ? publisher.legalname : 'Неизвестный издатель',\r\n            description: row.description,\r\n            categoryId: row.category_id,\r\n            addedToCart: cartByBookId.has(row.id_book),\r\n            addedAmount: cartByBookId.get(row.id_book) || 0,\r\n            isFavorite: favoriteIds.has(row.id_book),\r\n          };\r\n        });\r\n\r\n        setData(mapped);\r\n        console.log('Полученные книги:', mapped);\r\n      } catch (err) {\r\n        console.error('Ошибка при загрузке данных:', err);\r\n        setError(err.message);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchData();\r\n  }, []);\r\n\r\n  return { data, setData, error, loading };\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}