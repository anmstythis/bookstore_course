{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\My\\\\OneDrive\\\\\\u0414\\u043E\\u043A\\u0443\\u043C\\u0435\\u043D\\u0442\\u044B\\\\\\u043A\\u043E\\u043D\\u0441\\u043F\\u0435\\u043A\\u0442\\u044B\\\\\\u0434\\u043E\\u043A\\u0443\\u043C\\u0435\\u043D\\u0442\\u044B \\u043A \\u043A\\u0443\\u0440\\u0441\\u0430\\u0447\\u0443 4 \\u043A\\u0443\\u0440\\u0441\\\\project\\\\bookmix\\\\src\\\\pages\\\\Cart.js\",\n  _s2 = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport axios from 'axios';\nimport Card from '../components/CardMain.js';\nimport Footer from '../components/Footer.js';\nimport Header from '../components/Header.js';\nimport { motion } from 'framer-motion';\nimport { getCurrentUserId } from '../utils/userUtils.js';\nimport { getCartFromStorage, saveCartToStorage } from '../utils/cartUtils.js';\nimport { useBooksData } from '../utils/booksUtils.js';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst Cart = () => {\n  _s2();\n  const [data, setData] = useState([]);\n  useEffect(() => {\n    var _s = $RefreshSig$();\n    const fetchAll = async () => {\n      _s();\n      try {\n        setData(useBooksData());\n      } catch (err) {\n        console.error('Ошибка при загрузке данных корзины:', err);\n      }\n    };\n    _s(fetchAll, \"t14/nSS3Yxfh0cNykwnJFk/hv4s=\", false, function () {\n      return [useBooksData];\n    });\n    fetchAll();\n  }, []);\n  const handleCartChange = newCart => {\n    if (!getCurrentUserId()) return;\n    saveCartToStorage(newCart);\n    const cartByBookId = new Map(newCart.map(ci => [ci.bookId, ci.quantity]));\n    setData(prev => prev.map(p => ({\n      ...p,\n      addedAmount: cartByBookId.get(p.id) || 0,\n      addedToCart: cartByBookId.has(p.id)\n    })));\n  };\n  const calculateTotalPrice = () => {\n    return data.reduce((total, item) => total + item.addedAmount * item.price, 0);\n  };\n  const Sold = async () => {\n    try {\n      const userId = getCurrentUserId();\n      if (!userId) return;\n      const cart = getCartFromStorage(userId);\n      if (cart.length === 0) return;\n      const orderPayload = {\n        user_id: userId,\n        status_id: 1,\n        deliverytype_id: 1,\n        address_id: 1,\n        items: cart.map(ci => {\n          var _data$find;\n          return {\n            book_id: ci.bookId,\n            quantity: ci.quantity,\n            price: ((_data$find = data.find(d => d.id === ci.bookId)) === null || _data$find === void 0 ? void 0 : _data$find.price) || 0\n          };\n        })\n      };\n      console.log('Создание заказа:', orderPayload);\n      await axios.post('http://localhost:5000/api/orders', orderPayload);\n\n      // Очистка корзины\n      saveCartToStorage([], userId);\n      window.location.reload();\n    } catch (err) {\n      var _err$response;\n      console.error('Ошибка при создании заказа:', (err === null || err === void 0 ? void 0 : (_err$response = err.response) === null || _err$response === void 0 ? void 0 : _err$response.data) || err);\n      alert('Не удалось оформить заказ. Недостаточно экземпляров книги на складе.');\n    }\n  };\n  const BuyOption = () => {\n    const total = calculateTotalPrice();\n    if (total === 0) return null;\n    return /*#__PURE__*/_jsxDEV(motion.div, {\n      initial: {\n        x: 1000,\n        opacity: 0\n      },\n      animate: {\n        x: 0,\n        opacity: 1\n      },\n      transition: {\n        delay: 0.5,\n        duration: 1.5\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"u\", {\n        children: /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"total\",\n          children: [\"\\u041E\\u0431\\u0449\\u0430\\u044F \\u0446\\u0435\\u043D\\u0430: \", total, \" \\u0440\\u0443\\u0431.\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 88,\n          columnNumber: 12\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 88,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"buyButton\",\n        onClick: Sold,\n        children: \"\\u041A\\u0443\\u043F\\u0438\\u0442\\u044C\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 89,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 7\n    }, this);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(Header, {\n      title: \"\\u041A\\u043E\\u0440\\u0437\\u0438\\u043D\\u0430\",\n      description: calculateTotalPrice() !== 0 ? 'Вы ещё не передумали покупать книги? Так купите их прямо сейчас!' : 'В корзине пусто.'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(motion.div, {\n      initial: {\n        x: -1000,\n        opacity: 0\n      },\n      animate: {\n        x: 0,\n        opacity: 1\n      },\n      transition: {\n        delay: 0.5,\n        duration: 1.5\n      },\n      children: /*#__PURE__*/_jsxDEV(Card, {\n        term: d => d.addedToCart === true,\n        route: \"cart\",\n        onCartChange: handleCartChange\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 110,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(BuyOption, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Footer, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 95,\n    columnNumber: 5\n  }, this);\n};\n_s2(Cart, \"IEMTtLVFIuToo7X/raQbJAxzNQU=\");\n_c = Cart;\nexport default Cart;\nvar _c;\n$RefreshReg$(_c, \"Cart\");","map":{"version":3,"names":["React","useState","useEffect","axios","Card","Footer","Header","motion","getCurrentUserId","getCartFromStorage","saveCartToStorage","useBooksData","jsxDEV","_jsxDEV","Cart","_s2","data","setData","_s","$RefreshSig$","fetchAll","err","console","error","handleCartChange","newCart","cartByBookId","Map","map","ci","bookId","quantity","prev","p","addedAmount","get","id","addedToCart","has","calculateTotalPrice","reduce","total","item","price","Sold","userId","cart","length","orderPayload","user_id","status_id","deliverytype_id","address_id","items","_data$find","book_id","find","d","log","post","window","location","reload","_err$response","response","alert","BuyOption","div","initial","x","opacity","animate","transition","delay","duration","children","className","fileName","_jsxFileName","lineNumber","columnNumber","onClick","title","description","term","route","onCartChange","_c","$RefreshReg$"],"sources":["C:/Users/My/OneDrive/Документы/конспекты/документы к курсачу 4 курс/project/bookmix/src/pages/Cart.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport axios from 'axios';\nimport Card from '../components/CardMain.js';\nimport Footer from '../components/Footer.js';\nimport Header from '../components/Header.js';\nimport { motion } from 'framer-motion';\nimport { getCurrentUserId } from '../utils/userUtils.js';\nimport { getCartFromStorage, saveCartToStorage } from '../utils/cartUtils.js';\nimport { useBooksData } from '../utils/booksUtils.js';\n\nconst Cart = () => {\n  const [data, setData] = useState([]);\n\n  useEffect(() => {\n    const fetchAll = async () => {\n      try {\n        setData(useBooksData());\n      } catch (err) {\n        console.error('Ошибка при загрузке данных корзины:', err);\n      }\n    };\n\n    fetchAll();\n  }, []);\n\n  const handleCartChange = (newCart) => {\n    if (!getCurrentUserId()) return;\n\n    saveCartToStorage(newCart);\n\n    const cartByBookId = new Map(newCart.map(ci => [ci.bookId, ci.quantity]));\n    setData(prev =>\n      prev.map(p => ({\n        ...p,\n        addedAmount: cartByBookId.get(p.id) || 0,\n        addedToCart: cartByBookId.has(p.id),\n      }))\n    );\n  };\n\n  const calculateTotalPrice = () => {\n    return data.reduce((total, item) => total + item.addedAmount * item.price, 0);\n  };\n\n  const Sold = async () => {\n    try {\n      const userId = getCurrentUserId();\n      if (!userId) return;\n\n      const cart = getCartFromStorage(userId);\n      if (cart.length === 0) return;\n\n      const orderPayload = {\n        user_id: userId,\n        status_id: 1,\n        deliverytype_id: 1,\n        address_id: 1,\n        items: cart.map(ci => ({\n          book_id: ci.bookId,\n          quantity: ci.quantity,\n          price: data.find(d => d.id === ci.bookId)?.price || 0,\n        })),\n      };\n\n      console.log('Создание заказа:', orderPayload);\n\n      await axios.post('http://localhost:5000/api/orders', orderPayload);\n\n      // Очистка корзины\n      saveCartToStorage([], userId);\n      window.location.reload();\n    } catch (err) {\n      console.error('Ошибка при создании заказа:', err?.response?.data || err);\n      alert('Не удалось оформить заказ. Недостаточно экземпляров книги на складе.');\n    }\n  };\n\n  const BuyOption = () => {\n    const total = calculateTotalPrice();\n    if (total === 0) return null;\n\n    return (\n      <motion.div\n        initial={{ x: 1000, opacity: 0 }}\n        animate={{ x: 0, opacity: 1 }}\n        transition={{ delay: 0.5, duration: 1.5 }}\n      >\n        <u><p className='total'>Общая цена: {total} руб.</p></u>\n        <button className='buyButton' onClick={Sold}>Купить</button>\n      </motion.div>\n    );\n  };\n\n  return (\n    <div>\n      <Header\n        title=\"Корзина\"\n        description={\n          calculateTotalPrice() !== 0\n            ? 'Вы ещё не передумали покупать книги? Так купите их прямо сейчас!'\n            : 'В корзине пусто.'\n        }\n      />\n\n      <motion.div\n        initial={{ x: -1000, opacity: 0 }}\n        animate={{ x: 0, opacity: 1 }}\n        transition={{ delay: 0.5, duration: 1.5 }}\n      >\n        <Card\n          term={d => d.addedToCart === true}\n          route=\"cart\"\n          onCartChange={handleCartChange}\n        />\n      </motion.div>\n\n      <BuyOption />\n      <Footer />\n    </div>\n  );\n};\n\nexport default Cart;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}