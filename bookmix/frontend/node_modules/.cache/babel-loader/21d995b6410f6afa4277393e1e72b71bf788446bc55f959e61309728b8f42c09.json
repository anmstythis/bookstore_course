{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useEffect, useState } from 'react';\nimport axios from 'axios';\nimport { getCurrentUserId } from '../utils/userUtils.js';\nimport { getCartFromStorage } from '../utils/cartUtils.js';\nimport { getFavoritesFromStorage } from '../utils/favoriteUtils.js';\nexport const useBooksData = () => {\n  _s();\n  const [data, setData] = useState([]);\n  const [error, setError] = useState(null);\n  const [loading, setLoading] = useState(true);\n  useEffect(() => {\n    const fetchData = async () => {\n      try {\n        const [booksRes, authorsRes, publishersRes] = await Promise.all([axios.get('http://localhost:5000/api/books'), axios.get('http://localhost:5000/api/authors'), axios.get('http://localhost:5000/api/publishers')]);\n        const authors = authorsRes.data || [];\n        const publishers = publishersRes.data || [];\n        const userId = getCurrentUserId();\n        const cart = getCartFromStorage(userId);\n        const favorites = getFavoritesFromStorage(userId);\n        const cartByBookId = new Map(cart.map(ci => [ci.bookId, ci.quantity]));\n        const favoriteIds = new Set(favorites.map(f => f.bookId));\n        const mapped = (booksRes.data || []).map(row => {\n          const author = authors.find(a => a.id_author === row.author_id);\n          const publisher = publishers.find(p => p.id_publisher === row.publisher_id);\n          return {\n            id: row.id_book,\n            name: row.title,\n            authorId: row.author_id,\n            author: author ? `${author.firstname} ${author.lastname}` : 'Неизвестный автор',\n            price: Number(row.price),\n            url: row.imageurl,\n            publisher: publisher.legalname,\n            description: row.description,\n            categoryId: row.category_id,\n            addedToCart: cartByBookId.has(row.id_book),\n            addedAmount: cartByBookId.get(row.id_book) || 0,\n            isFavorite: favoriteIds.has(row.id_book)\n          };\n        });\n        setData(mapped);\n        console.log('Полученные книги:', mapped);\n      } catch (err) {\n        console.error('Ошибка при загрузке данных:', err);\n        setError(err.message);\n      } finally {\n        setLoading(false);\n      }\n    };\n    fetchData();\n  }, []);\n  return {\n    data,\n    setData,\n    error,\n    loading\n  };\n};\n_s(useBooksData, \"malMnQdwM2qcKJJQledZbUt2mHk=\");","map":{"version":3,"names":["useEffect","useState","axios","getCurrentUserId","getCartFromStorage","getFavoritesFromStorage","useBooksData","_s","data","setData","error","setError","loading","setLoading","fetchData","booksRes","authorsRes","publishersRes","Promise","all","get","authors","publishers","userId","cart","favorites","cartByBookId","Map","map","ci","bookId","quantity","favoriteIds","Set","f","mapped","row","author","find","a","id_author","author_id","publisher","p","id_publisher","publisher_id","id","id_book","name","title","authorId","firstname","lastname","price","Number","url","imageurl","legalname","description","categoryId","category_id","addedToCart","has","addedAmount","isFavorite","console","log","err","message"],"sources":["C:/Users/My/OneDrive/Документы/конспекты/документы к курсачу 4 курс/project/bookmix/src/utils/booksUtils.js"],"sourcesContent":["import { useEffect, useState } from 'react';\r\nimport axios from 'axios';\r\nimport { getCurrentUserId } from '../utils/userUtils.js';\r\nimport { getCartFromStorage } from '../utils/cartUtils.js';\r\nimport { getFavoritesFromStorage } from '../utils/favoriteUtils.js';\r\n\r\nexport const useBooksData = () => {\r\n  const [data, setData] = useState([]);\r\n  const [error, setError] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    const fetchData = async () => {\r\n      try {\r\n        const [booksRes, authorsRes, publishersRes] = await Promise.all([\r\n          axios.get('http://localhost:5000/api/books'),\r\n          axios.get('http://localhost:5000/api/authors'),\r\n          axios.get('http://localhost:5000/api/publishers')\r\n        ]);\r\n\r\n        const authors = authorsRes.data || [];\r\n        const publishers = publishersRes.data || [];\r\n\r\n        const userId = getCurrentUserId();\r\n        const cart = getCartFromStorage(userId);\r\n        const favorites = getFavoritesFromStorage(userId);\r\n\r\n        const cartByBookId = new Map(cart.map(ci => [ci.bookId, ci.quantity]));\r\n        const favoriteIds = new Set(favorites.map(f => f.bookId));\r\n\r\n        const mapped = (booksRes.data || []).map(row => {\r\n          const author = authors.find(a => a.id_author === row.author_id);\r\n          const publisher = publishers.find(p => p.id_publisher === row.publisher_id);\r\n\r\n          return {\r\n            id: row.id_book,\r\n            name: row.title,\r\n            authorId: row.author_id,\r\n            author: author ? `${author.firstname} ${author.lastname}` : 'Неизвестный автор',\r\n            price: Number(row.price),\r\n            url: row.imageurl,\r\n            publisher: publisher.legalname,\r\n            description: row.description,\r\n            categoryId: row.category_id,\r\n            addedToCart: cartByBookId.has(row.id_book),\r\n            addedAmount: cartByBookId.get(row.id_book) || 0,\r\n            isFavorite: favoriteIds.has(row.id_book),\r\n          };\r\n        });\r\n\r\n        setData(mapped);\r\n        console.log('Полученные книги:', mapped);\r\n      } catch (err) {\r\n        console.error('Ошибка при загрузке данных:', err);\r\n        setError(err.message);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchData();\r\n  }, []);\r\n\r\n  return { data, setData, error, loading };\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}