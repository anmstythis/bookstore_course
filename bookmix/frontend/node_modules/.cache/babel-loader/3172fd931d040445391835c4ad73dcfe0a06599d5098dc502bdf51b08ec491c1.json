{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\My\\\\OneDrive\\\\\\u0414\\u043E\\u043A\\u0443\\u043C\\u0435\\u043D\\u0442\\u044B\\\\\\u043A\\u043E\\u043D\\u0441\\u043F\\u0435\\u043A\\u0442\\u044B\\\\\\u0434\\u043E\\u043A\\u0443\\u043C\\u0435\\u043D\\u0442\\u044B \\u043A \\u043A\\u0443\\u0440\\u0441\\u0430\\u0447\\u0443 4 \\u043A\\u0443\\u0440\\u0441\\\\project\\\\bookmix\\\\src\\\\components\\\\AddEntity.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport api from \"../axiosSetup.js\";\nimport Header from \"../components/Header.js\";\nimport Form from \"../components/Form.js\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AddEntity = ({\n  title,\n  description,\n  apiPath,\n  fields\n}) => {\n  _s();\n  const navigate = useNavigate();\n  const [form, setForm] = useState({});\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(\"\");\n  const [options, setOptions] = useState({});\n  useEffect(() => {\n    const fetchOptions = async () => {\n      try {\n        const results = await Promise.all(fields.filter(f => f.type === \"select\" && f.source).map(f => api.get(f.source)));\n        const optionsData = {};\n        results.forEach((res, index) => {\n          const fieldName = fields.filter(f => f.type === \"select\")[index].name;\n          optionsData[fieldName] = res.data;\n        });\n        setOptions(optionsData);\n      } catch (err) {\n        console.error(\"Ошибка загрузки списков:\", err);\n        setError(\"Не удалось загрузить данные для выбора\");\n      }\n    };\n    fetchOptions();\n  }, [fields]);\n  useEffect(() => {\n    const handleEsc = e => {\n      if (e.key === \"Escape\") navigate(-1);\n    };\n    window.addEventListener(\"keydown\", handleEsc);\n    return () => window.removeEventListener(\"keydown\", handleEsc);\n  }, [navigate]);\n  const handleChange = (key, value) => {\n    setForm(prev => ({\n      ...prev,\n      [key]: value\n    }));\n  };\n  const handleSubmit = async e => {\n    e.preventDefault();\n    setLoading(true);\n    setError(\"\");\n    try {\n      await api.post(apiPath, form);\n      navigate(-1);\n    } catch (err) {\n      console.error(\"Ошибка добавления:\", err);\n      setError(\"Не удалось добавить запись\");\n    } finally {\n      setLoading(false);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(Header, {\n      title: title,\n      description: description\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"formContainer\",\n      children: /*#__PURE__*/_jsxDEV(Form, {\n        onSubmit: handleSubmit,\n        loading: loading,\n        error: error,\n        submitLabel: \"\\u0421\\u043E\\u0445\\u0440\\u0430\\u043D\\u0438\\u0442\\u044C\",\n        loadingLabel: \"\\u0421\\u043E\\u0445\\u0440\\u0430\\u043D\\u0435\\u043D\\u0438\\u0435...\",\n        formClassName: \"form\",\n        buttonClassName: \"formButton\",\n        children: [fields.map(field => /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"formContainer\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            className: \"formLabel\",\n            children: field.label\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 83,\n            columnNumber: 15\n          }, this), field.type === \"textarea\" ? /*#__PURE__*/_jsxDEV(\"textarea\", {\n            className: \"formInput\",\n            value: form[field.name] || \"\",\n            onChange: e => handleChange(field.name, e.target.value),\n            rows: \"3\",\n            required: field.required\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 86,\n            columnNumber: 17\n          }, this) : field.type === \"select\" ? /*#__PURE__*/_jsxDEV(\"select\", {\n            className: \"formInput\",\n            value: form[field.name] || \"\",\n            onChange: e => handleChange(field.name, e.target.value),\n            required: field.required,\n            children: [/*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"\",\n              children: \"\\u0412\\u044B\\u0431\\u0435\\u0440\\u0438\\u0442\\u0435...\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 100,\n              columnNumber: 19\n            }, this), (options[field.name] || []).map(opt => /*#__PURE__*/_jsxDEV(\"option\", {\n              value: opt.id_author || opt.id_publisher || opt.id_category || opt.id,\n              children: field.getLabel ? field.getLabel(opt) : opt.name\n            }, opt.id_author || opt.id_publisher || opt.id_category || opt.id, false, {\n              fileName: _jsxFileName,\n              lineNumber: 102,\n              columnNumber: 21\n            }, this))]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 94,\n            columnNumber: 17\n          }, this) : /*#__PURE__*/_jsxDEV(\"input\", {\n            type: field.type,\n            className: \"formInput\",\n            value: form[field.name] || \"\",\n            onChange: e => handleChange(field.name, e.target.value),\n            required: field.required\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 108,\n            columnNumber: 17\n          }, this)]\n        }, field.name, true, {\n          fileName: _jsxFileName,\n          lineNumber: 82,\n          columnNumber: 13\n        }, this)), form.imageurl && /*#__PURE__*/_jsxDEV(\"img\", {\n          src: form.imageurl,\n          alt: \"\\u041F\\u0440\\u0435\\u0432\\u044C\\u044E\",\n          className: \"card-img-top\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 120,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 72,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 71,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 69,\n    columnNumber: 5\n  }, this);\n};\n_s(AddEntity, \"JAbFHocklvt2xP548SuPnspJ+Nw=\", false, function () {\n  return [useNavigate];\n});\n_c = AddEntity;\nexport default AddEntity;\nvar _c;\n$RefreshReg$(_c, \"AddEntity\");","map":{"version":3,"names":["React","useState","useEffect","useNavigate","api","Header","Form","jsxDEV","_jsxDEV","AddEntity","title","description","apiPath","fields","_s","navigate","form","setForm","loading","setLoading","error","setError","options","setOptions","fetchOptions","results","Promise","all","filter","f","type","source","map","get","optionsData","forEach","res","index","fieldName","name","data","err","console","handleEsc","e","key","window","addEventListener","removeEventListener","handleChange","value","prev","handleSubmit","preventDefault","post","children","fileName","_jsxFileName","lineNumber","columnNumber","className","onSubmit","submitLabel","loadingLabel","formClassName","buttonClassName","field","label","onChange","target","rows","required","opt","id_author","id_publisher","id_category","id","getLabel","imageurl","src","alt","_c","$RefreshReg$"],"sources":["C:/Users/My/OneDrive/Документы/конспекты/документы к курсачу 4 курс/project/bookmix/src/components/AddEntity.js"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport api from \"../axiosSetup.js\";\r\nimport Header from \"../components/Header.js\";\r\nimport Form from \"../components/Form.js\";\r\n\r\nconst AddEntity = ({ title, description, apiPath, fields }) => {\r\n  const navigate = useNavigate();\r\n  const [form, setForm] = useState({});\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState(\"\");\r\n  const [options, setOptions] = useState({});\r\n\r\n  useEffect(() => {\r\n    const fetchOptions = async () => {\r\n      try {\r\n        const results = await Promise.all(\r\n          fields\r\n            .filter((f) => f.type === \"select\" && f.source)\r\n            .map((f) => api.get(f.source))\r\n        );\r\n\r\n        const optionsData = {};\r\n        results.forEach((res, index) => {\r\n          const fieldName = fields.filter((f) => f.type === \"select\")[index].name;\r\n          optionsData[fieldName] = res.data;\r\n        });\r\n\r\n        setOptions(optionsData);\r\n      } catch (err) {\r\n        console.error(\"Ошибка загрузки списков:\", err);\r\n        setError(\"Не удалось загрузить данные для выбора\");\r\n      }\r\n    };\r\n\r\n    fetchOptions();\r\n  }, [fields]);\r\n\r\n\r\n  useEffect(() => {\r\n    const handleEsc = (e) => {\r\n      if (e.key === \"Escape\") navigate(-1);\r\n    };\r\n    window.addEventListener(\"keydown\", handleEsc);\r\n    return () => window.removeEventListener(\"keydown\", handleEsc);\r\n  }, [navigate]);\r\n\r\n  const handleChange = (key, value) => {\r\n    setForm((prev) => ({ ...prev, [key]: value }));\r\n  };\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    setLoading(true);\r\n    setError(\"\");\r\n\r\n    try {\r\n      await api.post(apiPath, form);\r\n      navigate(-1);\r\n    } catch (err) {\r\n      console.error(\"Ошибка добавления:\", err);\r\n      setError(\"Не удалось добавить запись\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <Header title={title} description={description} />\r\n      <div className=\"formContainer\">\r\n        <Form\r\n          onSubmit={handleSubmit}\r\n          loading={loading}\r\n          error={error}\r\n          submitLabel=\"Сохранить\"\r\n          loadingLabel=\"Сохранение...\"\r\n          formClassName=\"form\"\r\n          buttonClassName=\"formButton\"\r\n        >\r\n          {fields.map((field) => (\r\n            <div key={field.name} className=\"formContainer\">\r\n              <label className=\"formLabel\">{field.label}</label>\r\n\r\n              {field.type === \"textarea\" ? (\r\n                <textarea\r\n                  className=\"formInput\"\r\n                  value={form[field.name] || \"\"}\r\n                  onChange={(e) => handleChange(field.name, e.target.value)}\r\n                  rows=\"3\"\r\n                  required={field.required}\r\n                />\r\n              ) : field.type === \"select\" ? (\r\n                <select\r\n                  className=\"formInput\"\r\n                  value={form[field.name] || \"\"}\r\n                  onChange={(e) => handleChange(field.name, e.target.value)}\r\n                  required={field.required}\r\n                >\r\n                  <option value=\"\">Выберите...</option>\r\n                  {(options[field.name] || []).map((opt) => (\r\n                    <option key={opt.id_author || opt.id_publisher || opt.id_category || opt.id} value={opt.id_author || opt.id_publisher || opt.id_category || opt.id}>\r\n                      {field.getLabel ? field.getLabel(opt) : opt.name}\r\n                    </option>\r\n                  ))}\r\n                </select>\r\n              ) : (\r\n                <input\r\n                  type={field.type}\r\n                  className=\"formInput\"\r\n                  value={form[field.name] || \"\"}\r\n                  onChange={(e) => handleChange(field.name, e.target.value)}\r\n                  required={field.required}\r\n                />\r\n              )}\r\n            </div>\r\n          ))}\r\n\r\n          {form.imageurl && (\r\n            <img src={form.imageurl} alt=\"Превью\" className=\"card-img-top\" />\r\n          )}\r\n        </Form>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AddEntity;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}