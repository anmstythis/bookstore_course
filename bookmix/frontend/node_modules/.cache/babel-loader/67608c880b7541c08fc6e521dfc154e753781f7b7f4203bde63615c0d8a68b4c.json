{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\My\\\\OneDrive\\\\\\u0414\\u043E\\u043A\\u0443\\u043C\\u0435\\u043D\\u0442\\u044B\\\\\\u043A\\u043E\\u043D\\u0441\\u043F\\u0435\\u043A\\u0442\\u044B\\\\\\u0434\\u043E\\u043A\\u0443\\u043C\\u0435\\u043D\\u0442\\u044B \\u043A \\u043A\\u0443\\u0440\\u0441\\u0430\\u0447\\u0443 4 \\u043A\\u0443\\u0440\\u0441\\\\project\\\\bookmix\\\\src\\\\pages\\\\ProductInfo.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState } from 'react';\nimport { useParams } from 'react-router-dom';\nimport axios from 'axios';\nimport Footer from '../components/Footer.js';\nimport Header from '../components/Header.js';\nimport { motion } from \"framer-motion\";\nimport Form from '../components/Form.js';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ProductInfo = () => {\n  _s();\n  const {\n    id\n  } = useParams();\n  const [book, setBook] = useState(null);\n  const [error, setError] = useState(null);\n  const [reviews, setReviews] = useState([]);\n  const [reviewsError, setReviewsError] = useState(null);\n  const [isSubmittingReview, setIsSubmittingReview] = useState(false);\n  const [isDeletingReviewId, setIsDeletingReviewId] = useState(null);\n  const [rating, setRating] = useState(5);\n  const [comment, setComment] = useState('');\n\n  // пользователь\n  const getCurrentUserId = () => {\n    try {\n      const userRaw = localStorage.getItem('user');\n      if (!userRaw) return null;\n      const parsed = JSON.parse(userRaw);\n      return (parsed === null || parsed === void 0 ? void 0 : parsed.id_user) || null;\n    } catch {\n      return null;\n    }\n  };\n\n  // корзина\n  const getCartFromStorage = userId => {\n    if (!userId) return [];\n    try {\n      const raw = localStorage.getItem(`cart:${userId}`);\n      return raw ? JSON.parse(raw) : [];\n    } catch {\n      return [];\n    }\n  };\n  const saveCartToStorage = (userId, cartItems) => {\n    if (!userId) return;\n    localStorage.setItem(`cart:${userId}`, JSON.stringify(cartItems));\n  };\n\n  // избранное\n  const getFavoritesFromStorage = userId => {\n    if (!userId) return [];\n    try {\n      const raw = localStorage.getItem(`favorites:${userId}`);\n      return raw ? JSON.parse(raw) : [];\n    } catch {\n      return [];\n    }\n  };\n  const saveFavoritesToStorage = (userId, favorites) => {\n    if (!userId) return;\n    localStorage.setItem(`favorites:${userId}`, JSON.stringify(favorites));\n  };\n  const toggleFavorite = () => {\n    if (!book) return;\n    const userId = getCurrentUserId();\n    if (!userId) {\n      alert('Войдите в систему, чтобы добавить книгу в избранное');\n      return;\n    }\n    const favorites = getFavoritesFromStorage(userId);\n    let updatedFavorites;\n    let isFavoriteNow;\n    if (favorites.includes(book.id)) {\n      updatedFavorites = favorites.filter(id => id !== book.id);\n      isFavoriteNow = false;\n    } else {\n      updatedFavorites = [...favorites, book.id];\n      isFavoriteNow = true;\n    }\n    saveFavoritesToStorage(userId, updatedFavorites);\n    const updated = {\n      ...book,\n      isFavorite: isFavoriteNow\n    };\n    setBook(updated);\n  };\n\n  // загрузка книги\n  useEffect(() => {\n    const fetchBook = async () => {\n      try {\n        const response = await axios.get(`http://localhost:5000/api/books/${id}`);\n        if (!response.data) throw new Error(\"Такой книги нет!\");\n        const row = response.data;\n        const authorResponse = await axios.get(`http://localhost:5000/api/authors/${row.author_id}`);\n        const author = authorResponse.data;\n        const userId = getCurrentUserId();\n        const cart = getCartFromStorage(userId);\n        const inCart = cart.find(ci => ci.bookId === row.id_book);\n        const favorites = getFavoritesFromStorage(userId);\n        const isFavorite = favorites.includes(row.id_book);\n        const mapped = {\n          id: row.id_book,\n          name: row.title,\n          authorId: row.author_id,\n          author: author ? `${author.firstname} ${author.patronymic ? author.patronymic : ' '} ${author.lastname} \n          (${author.birthdate ? author.birthdate.substring(0, 4) : '???'} - \n              ${author.deathdate ? author.deathdate.substring(0, 4) : 'н.в.'})` : 'Неизвестный автор',\n          country: row.country,\n          price: Number(row.price),\n          url: row.imageurl,\n          description: row.description,\n          addedToCart: Boolean(inCart),\n          addedAmount: inCart ? inCart.quantity : 0,\n          isFavorite\n        };\n        setBook(mapped);\n      } catch (err) {\n        console.error(\"Ошибка при загрузке:\", err);\n        setError(err.message);\n      }\n    };\n    fetchBook();\n  }, [id]);\n\n  // загрузка отзывов \n  useEffect(() => {\n    const fetchReviews = async () => {\n      try {\n        if (!id) return;\n        const {\n          data\n        } = await axios.get(`http://localhost:5000/api/reviews/book/${id}`);\n        setReviews(Array.isArray(data) ? data : []);\n      } catch (err) {\n        console.error('Ошибка при загрузке отзывов:', err);\n        setReviewsError('Не удалось загрузить отзывы');\n      }\n    };\n    fetchReviews();\n  }, [id]);\n\n  // добавление отзыва \n  const handleSubmitReview = async e => {\n    e.preventDefault();\n    if (!book) return;\n    const storedUserString = localStorage.getItem('user');\n    const storedUser = storedUserString ? JSON.parse(storedUserString) : null;\n    if (!(storedUser !== null && storedUser !== void 0 && storedUser.id_user)) {\n      setReviewsError('Для отправки отзыва необходимо войти в систему');\n      return;\n    }\n    try {\n      setIsSubmittingReview(true);\n      setReviewsError(null);\n      await axios.post('http://localhost:5000/api/reviews', {\n        user_id: storedUser.id_user,\n        book_id: book.id,\n        rating: Number(rating),\n        usercomment: comment\n      });\n      const {\n        data\n      } = await axios.get(`http://localhost:5000/api/reviews/book/${book.id}`);\n      setReviews(Array.isArray(data) ? data : []);\n      setRating(5);\n      setComment('');\n    } catch (err) {\n      console.error('Ошибка при отправке отзыва:', err);\n      setReviewsError('Не удалось отправить отзыв');\n    } finally {\n      setIsSubmittingReview(false);\n    }\n  };\n\n  // удаление отзыва\n  const handleDeleteReview = async reviewId => {\n    const storedUserString = localStorage.getItem('user');\n    const storedUser = storedUserString ? JSON.parse(storedUserString) : null;\n    if (!(storedUser !== null && storedUser !== void 0 && storedUser.id_user)) {\n      setReviewsError('Необходимо войти, чтобы удалять отзывы');\n      return;\n    }\n    if (!window.confirm('Удалить этот отзыв?')) {\n      return;\n    }\n    try {\n      setIsDeletingReviewId(reviewId);\n      setReviewsError(null);\n      await axios.delete(`http://localhost:5000/api/reviews/${reviewId}`);\n      const {\n        data\n      } = await axios.get(`http://localhost:5000/api/reviews/book/${id}`);\n      setReviews(Array.isArray(data) ? data : []);\n    } catch (err) {\n      console.error('Ошибка при удалении отзыва:', err);\n      setReviewsError('Не удалось удалить отзыв');\n    } finally {\n      setIsDeletingReviewId(null);\n    }\n  };\n\n  // добавление в корзину\n  const addToCart = () => {\n    if (!book) return;\n    const userId = getCurrentUserId();\n    const cart = getCartFromStorage(userId);\n    const exists = cart.find(ci => ci.bookId === book.id);\n    const newCart = exists ? cart.map(ci => ci.bookId === book.id ? {\n      ...ci,\n      quantity: ci.quantity + 1\n    } : ci) : [...cart, {\n      bookId: book.id,\n      quantity: 1\n    }];\n    saveCartToStorage(userId, newCart);\n    console.log('добавлено:', {\n      userId,\n      cart: newCart\n    });\n    const updated = {\n      ...book,\n      addedToCart: true,\n      addedAmount: (book.addedAmount || 0) + 1\n    };\n    setBook(updated);\n  };\n\n  // удаление из корзины\n  const removeFromCart = () => {\n    if (!book) return;\n    const userId = getCurrentUserId();\n    const cart = getCartFromStorage(userId);\n    const exists = cart.find(ci => ci.bookId === book.id);\n    let newCart;\n    if (!exists) {\n      newCart = cart;\n    } else if (exists.quantity <= 1) {\n      newCart = cart.filter(ci => ci.bookId !== book.id);\n    } else {\n      newCart = cart.map(ci => ci.bookId === book.id ? {\n        ...ci,\n        quantity: ci.quantity - 1\n      } : ci);\n    }\n    saveCartToStorage(userId, newCart);\n    console.log('удалено:', {\n      userId,\n      cart: newCart\n    });\n    const updatedAmount = Math.max((book.addedAmount || 0) - 1, 0);\n    const updated = {\n      ...book,\n      addedAmount: updatedAmount,\n      addedToCart: updatedAmount > 0\n    };\n    setBook(updated);\n  };\n  if (error) return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"welcome\",\n    children: [\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430: \", error]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 255,\n    columnNumber: 21\n  }, this);\n  if (!book) return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"welcome\",\n    children: \"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0430...\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 256,\n    columnNumber: 21\n  }, this);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(Header, {\n      title: \"\\u0421\\u0432\\u0435\\u0434\\u0435\\u043D\\u0438\\u044F \\u043E \\u043A\\u043D\\u0438\\u0433\\u0435\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 260,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(motion.div, {\n      className: \"productInfoCard\",\n      initial: {\n        opacity: 0,\n        scale: 0\n      },\n      animate: {\n        opacity: 1,\n        scale: 1\n      },\n      transition: {\n        delay: 0.5,\n        duration: 1\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"img\", {\n        className: \"prodImg\",\n        src: book.url,\n        alt: book.name\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 268,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: book.isFavorite ? 'favButton2' : 'notFavButton2',\n        onClick: toggleFavorite,\n        children: \"\\u2764\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 270,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n        className: \"titleProd\",\n        children: [\"\\u041D\\u0430\\u0437\\u0432\\u0430\\u043D\\u0438\\u0435: \", book.name]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 277,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n        className: \"authorProd\",\n        children: [\"\\u0410\\u0432\\u0442\\u043E\\u0440: \", book.author]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 278,\n        columnNumber: 9\n      }, this), book.country && /*#__PURE__*/_jsxDEV(\"h2\", {\n        className: \"countryProd\",\n        children: [\"\\u0421\\u0442\\u0440\\u0430\\u043D\\u0430: \", book.country]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 279,\n        columnNumber: 26\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"buttons2\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"cartButton\",\n          onClick: addToCart,\n          children: \"+\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 282,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"amount\",\n          children: book.addedAmount\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 283,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"cartButton\",\n          onClick: removeFromCart,\n          children: \"-\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 284,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 281,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"descrProd\",\n        children: book.description\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 287,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 262,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"reviewsSection\",\n      children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n        className: \"welcome\",\n        children: \"\\u041E\\u0442\\u0437\\u044B\\u0432\\u044B\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 291,\n        columnNumber: 9\n      }, this), reviews.length === 0 ? /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"head\",\n        children: \"\\u041F\\u043E\\u043A\\u0430 \\u043D\\u0435\\u0442 \\u043E\\u0442\\u0437\\u044B\\u0432\\u043E\\u0432.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 293,\n        columnNumber: 11\n      }, this) : /*#__PURE__*/_jsxDEV(\"ul\", {\n        className: \"reviewsList\",\n        children: reviews.map(rev => {\n          const storedUserString = localStorage.getItem('user');\n          const storedUser = storedUserString ? JSON.parse(storedUserString) : null;\n          const isMyReview = (storedUser === null || storedUser === void 0 ? void 0 : storedUser.id_user) && rev.user_id === storedUser.id_user;\n          return /*#__PURE__*/_jsxDEV(\"li\", {\n            className: \"reviewItem\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"reviewHeader\",\n              children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                children: [rev.firstname, \" \", rev.lastname]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 303,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                children: [\"\\u041E\\u0446\\u0435\\u043D\\u043A\\u0430: \", rev.rating]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 304,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                children: new Date(rev.reviewdate).toLocaleDateString()\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 305,\n                columnNumber: 21\n              }, this), isMyReview && /*#__PURE__*/_jsxDEV(\"button\", {\n                type: \"button\",\n                className: \"reviewDeleteBtn\",\n                onClick: () => handleDeleteReview(rev.id_review),\n                disabled: isDeletingReviewId === rev.id_review,\n                \"aria-label\": \"\\u0423\\u0434\\u0430\\u043B\\u0438\\u0442\\u044C \\u043E\\u0442\\u0437\\u044B\\u0432\",\n                title: \"\\u0423\\u0434\\u0430\\u043B\\u0438\\u0442\\u044C \\u043E\\u0442\\u0437\\u044B\\u0432\",\n                children: isDeletingReviewId === rev.id_review ? '…' : '✕'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 307,\n                columnNumber: 23\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 302,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"reviewComment\",\n              children: rev.usercomment\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 319,\n              columnNumber: 19\n            }, this)]\n          }, rev.id_review, true, {\n            fileName: _jsxFileName,\n            lineNumber: 301,\n            columnNumber: 17\n          }, this);\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 295,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"formContainer\",\n        children: /*#__PURE__*/_jsxDEV(Form, {\n          onSubmit: handleSubmitReview,\n          loading: isSubmittingReview,\n          error: reviewsError || '',\n          submitLabel: \"\\u041E\\u0442\\u043F\\u0440\\u0430\\u0432\\u0438\\u0442\\u044C \\u043E\\u0442\\u0437\\u044B\\u0432\",\n          loadingLabel: \"\\u041E\\u0442\\u043F\\u0440\\u0430\\u0432\\u043A\\u0430...\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"formLabel\",\n            role: \"radiogroup\",\n            \"aria-label\": \"\\u041E\\u0446\\u0435\\u043D\\u043A\\u0430\",\n            children: [1, 2, 3, 4, 5].map(value => /*#__PURE__*/_jsxDEV(\"button\", {\n              type: \"button\",\n              className: value <= Number(rating) ? 'favButton' : 'notFavButton',\n              \"aria-checked\": value === Number(rating),\n              role: \"radio\",\n              onClick: () => !isSubmittingReview && setRating(value),\n              disabled: isSubmittingReview,\n              children: value <= Number(rating) ? '★' : '☆'\n            }, value, false, {\n              fileName: _jsxFileName,\n              lineNumber: 335,\n              columnNumber: 17\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 333,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n            className: \"formInput\",\n            value: comment,\n            onChange: e => setComment(e.target.value),\n            placeholder: \"\\u041F\\u043E\\u0434\\u0435\\u043B\\u0438\\u0442\\u0435\\u0441\\u044C \\u0432\\u043F\\u0435\\u0447\\u0430\\u0442\\u043B\\u0435\\u043D\\u0438\\u0435\\u043C \\u043E \\u043A\\u043D\\u0438\\u0433\\u0435\",\n            rows: 4,\n            disabled: isSubmittingReview\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 348,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 326,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 325,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 290,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(motion.div, {\n      initial: {\n        y: 1000\n      },\n      animate: {\n        y: 0\n      },\n      transition: {\n        duration: 1.5\n      },\n      children: /*#__PURE__*/_jsxDEV(Footer, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 364,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 359,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 259,\n    columnNumber: 5\n  }, this);\n};\n_s(ProductInfo, \"BOOBQKDckqGd2wBeN2xmuy62Z5k=\", false, function () {\n  return [useParams];\n});\n_c = ProductInfo;\nexport default ProductInfo;\nvar _c;\n$RefreshReg$(_c, \"ProductInfo\");","map":{"version":3,"names":["React","useEffect","useState","useParams","axios","Footer","Header","motion","Form","jsxDEV","_jsxDEV","ProductInfo","_s","id","book","setBook","error","setError","reviews","setReviews","reviewsError","setReviewsError","isSubmittingReview","setIsSubmittingReview","isDeletingReviewId","setIsDeletingReviewId","rating","setRating","comment","setComment","getCurrentUserId","userRaw","localStorage","getItem","parsed","JSON","parse","id_user","getCartFromStorage","userId","raw","saveCartToStorage","cartItems","setItem","stringify","getFavoritesFromStorage","saveFavoritesToStorage","favorites","toggleFavorite","alert","updatedFavorites","isFavoriteNow","includes","filter","updated","isFavorite","fetchBook","response","get","data","Error","row","authorResponse","author_id","author","cart","inCart","find","ci","bookId","id_book","mapped","name","title","authorId","firstname","patronymic","lastname","birthdate","substring","deathdate","country","price","Number","url","imageurl","description","addedToCart","Boolean","addedAmount","quantity","err","console","message","fetchReviews","Array","isArray","handleSubmitReview","e","preventDefault","storedUserString","storedUser","post","user_id","book_id","usercomment","handleDeleteReview","reviewId","window","confirm","delete","addToCart","exists","newCart","map","log","removeFromCart","updatedAmount","Math","max","className","children","fileName","_jsxFileName","lineNumber","columnNumber","div","initial","opacity","scale","animate","transition","delay","duration","src","alt","onClick","length","rev","isMyReview","Date","reviewdate","toLocaleDateString","type","id_review","disabled","onSubmit","loading","submitLabel","loadingLabel","role","value","onChange","target","placeholder","rows","y","_c","$RefreshReg$"],"sources":["C:/Users/My/OneDrive/Документы/конспекты/документы к курсачу 4 курс/project/bookmix/src/pages/ProductInfo.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { useParams } from 'react-router-dom';\nimport axios from 'axios';\nimport Footer from '../components/Footer.js';\nimport Header from '../components/Header.js';\nimport { motion } from \"framer-motion\";\nimport Form from '../components/Form.js';\n\nconst ProductInfo = () => {\n  const { id } = useParams(); \n  const [book, setBook] = useState(null);\n  const [error, setError] = useState(null);\n  const [reviews, setReviews] = useState([]);\n  const [reviewsError, setReviewsError] = useState(null);\n  const [isSubmittingReview, setIsSubmittingReview] = useState(false);\n  const [isDeletingReviewId, setIsDeletingReviewId] = useState(null);\n  const [rating, setRating] = useState(5);\n  const [comment, setComment] = useState('');\n\n    // пользователь\n  const getCurrentUserId = () => {\n    try {\n      const userRaw = localStorage.getItem('user');\n      if (!userRaw) return null;\n      const parsed = JSON.parse(userRaw);\n      return parsed?.id_user || null;\n    } catch {\n      return null;\n    }\n  };\n\n  // корзина\n  const getCartFromStorage = (userId) => {\n    if (!userId) return [];\n    try {\n      const raw = localStorage.getItem(`cart:${userId}`);\n      return raw ? JSON.parse(raw) : [];\n    } catch {\n      return [];\n    }\n  };\n\n  const saveCartToStorage = (userId, cartItems) => {\n    if (!userId) return;\n    localStorage.setItem(`cart:${userId}`, JSON.stringify(cartItems));\n  };\n\n  // избранное\n  const getFavoritesFromStorage = (userId) => {\n    if (!userId) return [];\n    try {\n      const raw = localStorage.getItem(`favorites:${userId}`);\n      return raw ? JSON.parse(raw) : [];\n    } catch {\n      return [];\n    }\n  };\n\n  const saveFavoritesToStorage = (userId, favorites) => {\n    if (!userId) return;\n    localStorage.setItem(`favorites:${userId}`, JSON.stringify(favorites));\n  };\n\n  const toggleFavorite = () => {\n    if (!book) return;\n    const userId = getCurrentUserId();\n    if (!userId) {\n      alert('Войдите в систему, чтобы добавить книгу в избранное');\n      return;\n    }\n\n    const favorites = getFavoritesFromStorage(userId);\n    let updatedFavorites;\n    let isFavoriteNow;\n\n    if (favorites.includes(book.id)) {\n      updatedFavorites = favorites.filter((id) => id !== book.id);\n      isFavoriteNow = false;\n    } else {\n      updatedFavorites = [...favorites, book.id];\n      isFavoriteNow = true;\n    }\n\n    saveFavoritesToStorage(userId, updatedFavorites);\n\n    const updated = { ...book, isFavorite: isFavoriteNow };\n    setBook(updated);\n  };\n\n  // загрузка книги\n  useEffect(() => {\n    const fetchBook = async () => {\n      try {\n        const response = await axios.get(`http://localhost:5000/api/books/${id}`);\n        if (!response.data) throw new Error(\"Такой книги нет!\");\n        const row = response.data;\n\n        const authorResponse = await axios.get(`http://localhost:5000/api/authors/${row.author_id}`);\n        const author = authorResponse.data;\n\n        const userId = getCurrentUserId();\n        const cart = getCartFromStorage(userId);\n        const inCart = cart.find(ci => ci.bookId === row.id_book);\n        const favorites = getFavoritesFromStorage(userId);\n        const isFavorite = favorites.includes(row.id_book);\n\n        const mapped = {\n          id: row.id_book,\n          name: row.title,\n          authorId: row.author_id,\n          author: author ? `${author.firstname} ${author.patronymic ? author.patronymic : ' '} ${author.lastname} \n          (${author.birthdate ? author.birthdate.substring(0, 4) : '???'} - \n              ${author.deathdate ? author.deathdate.substring(0, 4) : 'н.в.'})` : 'Неизвестный автор',\n          country: row.country,\n          price: Number(row.price),\n          url: row.imageurl,\n          description: row.description,\n          addedToCart: Boolean(inCart),\n          addedAmount: inCart ? inCart.quantity : 0,\n          isFavorite\n        };\n\n        setBook(mapped);\n      } catch (err) {\n        console.error(\"Ошибка при загрузке:\", err);\n        setError(err.message);\n      }\n    };\n\n    fetchBook();\n  }, [id]);\n\n  // загрузка отзывов \n  useEffect(() => {\n    const fetchReviews = async () => {\n      try {\n        if (!id) return;\n        const { data } = await axios.get(`http://localhost:5000/api/reviews/book/${id}`);\n        setReviews(Array.isArray(data) ? data : []);\n      } catch (err) {\n        console.error('Ошибка при загрузке отзывов:', err);\n        setReviewsError('Не удалось загрузить отзывы');\n      }\n    };\n\n    fetchReviews();\n  }, [id]);\n\n  // добавление отзыва \n  const handleSubmitReview = async (e) => {\n    e.preventDefault();\n    if (!book) return;\n    const storedUserString = localStorage.getItem('user');\n    const storedUser = storedUserString ? JSON.parse(storedUserString) : null;\n    if (!storedUser?.id_user) {\n      setReviewsError('Для отправки отзыва необходимо войти в систему');\n      return;\n    }\n\n    try {\n      setIsSubmittingReview(true);\n      setReviewsError(null);\n      await axios.post('http://localhost:5000/api/reviews', {\n        user_id: storedUser.id_user,\n        book_id: book.id,\n        rating: Number(rating),\n        usercomment: comment\n      });\n\n      const { data } = await axios.get(`http://localhost:5000/api/reviews/book/${book.id}`);\n      setReviews(Array.isArray(data) ? data : []);\n      setRating(5);\n      setComment('');\n    } catch (err) {\n      console.error('Ошибка при отправке отзыва:', err);\n      setReviewsError('Не удалось отправить отзыв');\n    } finally {\n      setIsSubmittingReview(false);\n    }\n  };\n\n  // удаление отзыва\n  const handleDeleteReview = async (reviewId) => {\n    const storedUserString = localStorage.getItem('user');\n    const storedUser = storedUserString ? JSON.parse(storedUserString) : null;\n    if (!storedUser?.id_user) {\n      setReviewsError('Необходимо войти, чтобы удалять отзывы');\n      return;\n    }\n\n    if (!window.confirm('Удалить этот отзыв?')) {\n      return;\n    }\n\n    try {\n      setIsDeletingReviewId(reviewId);\n      setReviewsError(null);\n      await axios.delete(`http://localhost:5000/api/reviews/${reviewId}`);\n      const { data } = await axios.get(`http://localhost:5000/api/reviews/book/${id}`);\n      setReviews(Array.isArray(data) ? data : []);\n    } catch (err) {\n      console.error('Ошибка при удалении отзыва:', err);\n      setReviewsError('Не удалось удалить отзыв');\n    } finally {\n      setIsDeletingReviewId(null);\n    }\n  };\n\n  // добавление в корзину\n  const addToCart = () => {\n    if (!book) return;\n    const userId = getCurrentUserId();\n    const cart = getCartFromStorage(userId);\n    const exists = cart.find(ci => ci.bookId === book.id);\n    const newCart = exists\n      ? cart.map(ci => ci.bookId === book.id ? { ...ci, quantity: ci.quantity + 1 } : ci)\n      : [...cart, { bookId: book.id, quantity: 1 }];\n    saveCartToStorage(userId, newCart);\n    console.log('добавлено:', { userId, cart: newCart });\n\n    const updated = {\n      ...book,\n      addedToCart: true,\n      addedAmount: (book.addedAmount || 0) + 1\n    };\n    setBook(updated);\n  };\n\n  // удаление из корзины\n  const removeFromCart = () => {\n    if (!book) return;\n    const userId = getCurrentUserId();\n    const cart = getCartFromStorage(userId);\n    const exists = cart.find(ci => ci.bookId === book.id);\n    let newCart;\n    if (!exists) {\n      newCart = cart;\n    } else if (exists.quantity <= 1) {\n      newCart = cart.filter(ci => ci.bookId !== book.id);\n    } else {\n      newCart = cart.map(ci => ci.bookId === book.id ? { ...ci, quantity: ci.quantity - 1 } : ci);\n    }\n    saveCartToStorage(userId, newCart);\n    console.log('удалено:', { userId, cart: newCart });\n\n    const updatedAmount = Math.max((book.addedAmount || 0) - 1, 0);\n    const updated = {\n      ...book,\n      addedAmount: updatedAmount,\n      addedToCart: updatedAmount > 0\n    };\n    setBook(updated);\n  };\n\n  if (error) return <div className='welcome'>Ошибка: {error}</div>;\n  if (!book) return <div className='welcome'>Загрузка...</div>;\n\n  return (\n    <div>\n      <Header title=\"Сведения о книге\" />\n\n      <motion.div\n        className='productInfoCard'\n        initial={{ opacity: 0, scale: 0 }}\n        animate={{ opacity: 1, scale: 1 }}\n        transition={{ delay: 0.5, duration: 1 }}\n      >\n        <img className='prodImg' src={book.url} alt={book.name} />\n\n        <button\n          className={book.isFavorite ? 'favButton2' : 'notFavButton2'}\n          onClick={toggleFavorite}\n        >\n          ❤\n        </button>\n\n        <h2 className='titleProd'>Название: {book.name}</h2>\n        <h2 className='authorProd'>Автор: {book.author}</h2>\n        {book.country && <h2 className='countryProd'>Страна: {book.country}</h2>}\n\n        <div className='buttons2'>\n          <button className='cartButton' onClick={addToCart}>+</button>\n          <span className='amount'>{book.addedAmount}</span>\n          <button className='cartButton' onClick={removeFromCart}>-</button>\n        </div>\n\n        <p className='descrProd'>{book.description}</p>\n      </motion.div>\n\n      <div className='reviewsSection'>\n        <h3 className='welcome'>Отзывы</h3>\n          {reviews.length === 0 ? (\n          <p className='head'>Пока нет отзывов.</p>\n        ) : (\n          <ul className='reviewsList'>\n            {reviews.map((rev) => {\n              const storedUserString = localStorage.getItem('user');\n              const storedUser = storedUserString ? JSON.parse(storedUserString) : null;\n              const isMyReview = storedUser?.id_user && rev.user_id === storedUser.id_user;\n              return (\n                <li key={rev.id_review} className='reviewItem'>\n                  <div className='reviewHeader'>\n                    <strong>{rev.firstname} {rev.lastname}</strong>\n                    <span>Оценка: {rev.rating}</span>\n                    <span>{new Date(rev.reviewdate).toLocaleDateString()}</span>\n                    {isMyReview && (\n                      <button\n                        type='button'\n                        className='reviewDeleteBtn'\n                        onClick={() => handleDeleteReview(rev.id_review)}\n                        disabled={isDeletingReviewId === rev.id_review}\n                        aria-label='Удалить отзыв'\n                        title='Удалить отзыв'\n                      >\n                        {isDeletingReviewId === rev.id_review ? '…' : '✕'}\n                      </button>\n                    )}\n                  </div>\n                  <div className='reviewComment'>{rev.usercomment}</div>\n                </li>\n              );\n            })}\n          </ul>\n        )}\n        <div className='formContainer'>\n          <Form\n            onSubmit={handleSubmitReview}\n            loading={isSubmittingReview}\n            error={reviewsError || ''}\n            submitLabel=\"Отправить отзыв\"\n            loadingLabel=\"Отправка...\"\n          >\n            <div className='formLabel' role='radiogroup' aria-label='Оценка'>\n              {[1,2,3,4,5].map((value) => (\n                <button\n                  key={value}\n                  type='button'\n                  className={value <= Number(rating) ? 'favButton' : 'notFavButton'}\n                  aria-checked={value === Number(rating)}\n                  role='radio'\n                  onClick={() => !isSubmittingReview && setRating(value)}\n                  disabled={isSubmittingReview}\n                >\n                  {value <= Number(rating) ? '★' : '☆'}\n                </button>\n              ))}\n            </div>\n            <textarea className='formInput'\n              value={comment}\n              onChange={(e) => setComment(e.target.value)}\n              placeholder='Поделитесь впечатлением о книге'\n              rows={4}\n              disabled={isSubmittingReview}\n            />\n          </Form>\n        </div>\n      </div>\n\n      <motion.div\n        initial={{ y: 1000 }}\n        animate={{ y: 0 }}\n        transition={{ duration: 1.5 }}\n      >\n        <Footer />\n      </motion.div>\n    </div>\n  );\n};\n\nexport default ProductInfo;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}